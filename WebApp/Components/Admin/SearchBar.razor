
<div class="search-bar">
    <div class="search-input-wrapper">
        <i class="search-icon">üîç</i>
        <input type="text" 
               class="search-input font-text" 
               placeholder="@Placeholder"
               @bind="searchText"
               @bind:event="oninput"
               @onkeyup="HandleKeyUp" />
        @if (!string.IsNullOrWhiteSpace(searchText))
        {
            <button class="search-clear" @onclick="ClearSearch">
                <i>‚úï</i>
            </button>
        }
    </div>
</div>

@code {
    private string searchText = string.Empty;
    private System.Timers.Timer? debounceTimer;

    [Parameter]
    public string Placeholder { get; set; } = "Search...";

    [Parameter]
    public EventCallback<string> OnSearch { get; set; }

    [Parameter]
    public int DebounceMs { get; set; } = 300;

    private void HandleKeyUp()
    {
        debounceTimer?.Stop();
        debounceTimer?.Dispose();

        debounceTimer = new System.Timers.Timer(DebounceMs);
        debounceTimer.Elapsed += async (sender, e) =>
        {
            debounceTimer?.Stop();
            await InvokeAsync(async () =>
            {
                await OnSearch.InvokeAsync(searchText);
                StateHasChanged();
            });
        };
        debounceTimer.Start();
    }

    private async Task ClearSearch()
    {
        searchText = string.Empty;
        await OnSearch.InvokeAsync(string.Empty);
    }

    public void Dispose()
    {
        debounceTimer?.Dispose();
    }
}
